- name: Clean DerivedData
  run: rm -rf ~/Library/Developer/Xcode/DerivedData

- name: Set permissions for DerivedData
  run: sudo chmod -R 777 ~/Library/Developer/Xcode/DerivedData

- name: üßπ Clean and Get Packages
  run: |
    flutter clean
    flutter pub get

- name: üçé Install CocoaPods
  run: |
    cd ios
    pod deintegrate
    pod install
    cd ..

- name: ‚ùå Disable Code Signing & Bitcode
  run: |
    cd ios
    sed -i '' 's/CODE_SIGN_STYLE = .*/CODE_SIGN_STYLE = Manual;/' Runner.xcodeproj/project.pbxproj
    sed -i '' 's/CODE_SIGN_IDENTITY = .*/CODE_SIGN_IDENTITY = "";/' Runner.xcodeproj/project.pbxproj
    sed -i '' 's/DEVELOPMENT_TEAM = .*/DEVELOPMENT_TEAM = "";/' Runner.xcodeproj/project.pbxproj
    sed -i '' 's/PROVISIONING_PROFILE_SPECIFIER = .*/PROVISIONING_PROFILE_SPECIFIER = "";/' Runner.xcodeproj/project.pbxproj
    sed -i '' 's/ENABLE_BITCODE = .*/ENABLE_BITCODE = NO;/' Runner.xcodeproj/project.pbxproj || echo "No ENABLE_BITCODE to update"
    cd ..

- name: Build Unsigned IPA
  run: flutter build ipa --release --no-codesign --verbose
